# 🏋️ AI Workout Coach: Your Smart Strength Training Companion

## Overview

The AI Workout Coach is a Streamlit-powered web application designed to optimize your strength training. It intelligently analyzes your historical workout performance, combining machine learning predictions with common-sense strength training principles to provide personalized weight recommendations for your next session. Track your progress, get smart guidance, and achieve progressive overload more effectively!

The application leverages **Google Sheets as its backend database** for all workout logs and dynamic exercise configurations, allowing for easy data management and remote access.

## Key Features

- **Personalized Weight Recommendations:** Get AI-powered suggestions for your next exercise weight. The system learns from your past sets, reps, and Rate of Perceived Exertion (RPE) to suggest optimal loads.
- **Integrated Workout Logging:** Conveniently log your completed workouts directly from the recommendation page, or use the dedicated "Log Workout" page. Capture essential metrics like exercise, weight, reps, sets, RPE, and notes. All logs are securely saved to your designated Google Sheet.
- **Dynamic Exercise Management:** Effortlessly add new exercises on the fly. The app will learn and adapt its recommendations as you log data for these new movements. Exercise-specific progression rules (increments, deloads, target reps) are also managed via a dedicated Google Sheet tab.
- **Real-time Model Retraining:** Every time you log a new workout, the underlying machine learning model automatically re-trains itself with your latest data, ensuring your recommendations are always up-to-date and highly personalized.
- **Hybrid Recommendation Engine:** Recommendations are generated by a robust Random Forest Regressor model, then refined by practical strength training rules to ensure safety, progressive overload, and adherence to best practices (e.g., sensible weight increments, controlled deloading strategies). This dual approach provides both data-driven and principled guidance.
- **Workout History & Visualization:** Review your past training sessions, visualize your progress over time with interactive charts (e.g., weight progression), and gain insights into your strength journey.
- **Model Insights (Planned):** A dedicated section to understand how the AI coach works, potentially including feature importances and model performance metrics (e.g., MAE, R2 score). _Note: This feature can be expanded with more detailed visualizations of model behavior._

## How it Works

1.  **Google Sheet Integration:**
    - **Data Collection:** You log your workouts via the app. This raw data is directly appended to the `Raw Data` tab in your designated Google Sheet.
    - **Exercise Configuration:** Exercise-specific parameters (`min_inc`, `max_inc`, `target_reps_min`, `deload_pct`, etc.) are read from the `Exercise Info` tab in your Google Sheet, allowing you to easily customize progression rules without code changes.
2.  **Data Transformation (`src/transform.py`):** Your raw workout data (from the Google Sheet's `Raw Data` tab) is automatically cleaned and enriched with calculated features relevant to strength training (e.g., volume, intensity, RIR - Reps in Reserve estimation). This processed data is then written to the `Processed Data` tab in your Google Sheet.
3.  **Model Training (`src/train_model.py`):** A Random Forest Regressor is trained on your transformed historical data (from the Google Sheet's `Processed Data` tab). This model learns the complex relationship between your past performance metrics and the optimal weight for your next session. The trained model and related artifacts (like the `LabelEncoder` for exercises and `model_features`) are saved locally in the `models/` directory.
4.  **Prediction & Rule-Based Refinement (`src/utils.py` and other app logic):**
    - When you request a recommendation, your most recent performance for the selected exercise is fed to the trained ML model, which predicts a raw next weight.
    - This raw prediction is then passed through a set of carefully defined, rule-based logic (primarily within `apply_post_prediction_rules` in `src/utils.py`). These rules incorporate human coaching principles, ensuring the final recommendation is practical, safe, and aligned with effective progressive overload strategies. **Crucially, for scenarios like deloads or minor rep failures, the rule-based logic can override or heavily influence the ML prediction to ensure sensible outcomes that prioritize user safety and effective training cycles.**
5.  **Continuous Learning:** The entire data transformation and model retraining pipeline runs automatically in the background after each new workout you log. This ensures the AI coach continuously learns from your unique training journey, and your rules are applied to the latest data.

## Project Structure

```
ai-workout-app/
├── app/
│   ├── app.py                     # Main Streamlit entry point, sets up sys.path
│   └── pages/
│       ├── 01_Get_Recommendation.py # Get AI recommendations, log workout from here
│       ├── 02_Log_Workout.py      # Dedicated page for logging workouts
│       ├── 03_Model_Insights.py   # Page for model performance & insights (Expandable)
│       └── 04_Workout_History.py  # Visualize and analyze workout history
├── data/
│   ├── (No CSVs here for primary data, now using Google Sheets)
│   └── (Optional: 50-Day_Workout_Log.csv could be a local backup/template)
├── models/
│   ├── trained_regressor_model.joblib # The trained ML model
│   ├── exercise_label_encoder.joblib  # Encodes exercise names to numbers
│   └── model_features.joblib      # List of features used by the model
├── src/
│   ├── transform.py               # Data preprocessing script (reads/writes to Google Sheets)
│   ├── train_model.py             # Model training script (reads from Google Sheets)
│   ├── utils.py                   # Shared utility functions (e.g., log_workout, apply_post_prediction_rules)
│   └── init.py                # Makes 'src' a Python package for imports
├── notebooks/                     # (Optional) For EDA, model experimentation
│   ├── EDA_Workout_Data.ipynb
│   └── Model_Experimentation.ipynb
├── README.md                      # This file
├── requirements.txt               # Python dependencies
├── .env                           # Stores GOOGLE_SHEET_ID (REQUIRED!)
└── .gitignore                     # Files/directories to ignore by Git
```

## Setup and Installation

Follow these steps to get the AI Workout Coach running on your local machine:

### 1. Google Cloud Project & Service Account Setup

This application uses Google Sheets as its primary data source and storage. You'll need to set up a Google Cloud Project and a Service Account to allow your app to access your sheets programmatically.

1.  **Create a Google Cloud Project:** Go to the [Google Cloud Console](https://console.cloud.google.com/) and create a new project.
2.  **Enable APIs:** In your new project, navigate to **APIs & Services > Enabled APIs & services**. Click `+ ENABLE APIS AND SERVICES` and enable the following:
    - `Google Sheets API`
    - `Google Drive API`
3.  **Create a Service Account:**
    - Navigate to **IAM & Admin > Service Accounts**.
    - Click `+ CREATE SERVICE ACCOUNT`.
    - Give it a name (e.g., `ai-workout-app-service`).
    - For `Grant this service account access to project`, you can select the `Editor` role. While a more granular role might be possible, `Editor` is typically sufficient for read/write access to sheets.
    - Click `DONE`.
4.  **Generate a JSON Key:**
    - Click on the newly created service account.
    - Go to the `Keys` tab.
    - Click `ADD KEY > Create new key`.
    - Select `JSON` and click `CREATE`.
    - This will download a JSON file (e.g., `your-project-id-xxxxxxxxxxxx.json`). **Rename this file to `google_credentials.json`** and place it directly in the root directory of your `ai-workout-app` project. **Keep this file secure!**

### 2. Google Sheet Configuration

1.  **Create a New Google Sheet:** This will serve as your application's database. Name it something descriptive, like "AI Workout Data".
2.  **Share the Sheet with your Service Account:**
    - Click the `Share` button in the top right corner of your new Google Sheet.
    - Locate the `client_email` field within your downloaded `google_credentials.json` file. This is your service account's email address.
    - Paste this `client_email` into the "Share with people and groups" field.
    - Ensure the permission is set to **Editor**.
    - Click `Share`.
3.  **Create Required Tabs (Sheets) within your Google Sheet:**

    - **`Raw Data`**: This tab will store all your workout logs as entered through the app.
      - **Required Columns (case-sensitive):** `Date`, `Exercise`, `Weight (lbs)`, `Reps`, `RPE`, `Notes` (add more if your `transform.py` expects them).
      - _(You can initially leave it empty or add some sample data manually for testing)._
    - **`Processed Data`**: This tab will be automatically populated and overwritten by the `src/transform.py` script. It contains the engineered features and the `next_weight_lbs` target variable used for ML training. **Do NOT manually edit this tab.**
    - **`Exercise Info`**: This tab allows you to configure exercise-specific rules and defaults.
      - **Required Columns (case-sensitive):** `exercise_name`, `min_inc`, `max_inc`, `target_reps_min`, `target_reps_max`, `deload_pct`, `min_set_rpe`, `max_set_rpe`, `default_target_reps`, `min_reps`, `max_reps`.
      - _(Populate this with initial data for your exercises. The `exercise_name` must exactly match how you'll log exercises in `Raw Data`.)_

4.  **Get Google Sheet ID:** The Sheet ID is the long alphanumeric string in your Google Sheet's URL, located between `/d/` and `/edit`. Copy this ID.

### 3. Python Environment Setup

1.  **Navigate to your project directory:**
    ```bash
    cd ai-workout-app
    ```
2.  **Create a Python virtual environment (highly recommended):**
    ```bash
    python3 -m venv env
    ```
3.  **Activate the virtual environment:**
    - **macOS/Linux:**
      ```bash
      source env/bin/activate
      ```
    - **Windows (Command Prompt):**
      ```bash
      .\env\Scripts\activate.bat
      ```
    - **Windows (PowerShell):**
      ```powershell
      .\env\Scripts\Activate.ps1
      ```
4.  **Install dependencies:**

    ```bash
    pip install -r requirements.txt
    ```

    (Ensure `requirements.txt` includes `streamlit`, `pandas`, `scikit-learn`, `gspread`, `oauth2client`, `joblib`, `python-dotenv`).

5.  **Create a `.env` file:** In the root directory of your project (`ai-workout-app/`), create a file named `.env` and add your Google Sheet ID:
    ```dotenv
    GOOGLE_SHEET_ID=YOUR_GOOGLE_SHEET_ID_HERE
    ```
    Replace `YOUR_GOOGLE_SHEET_ID_HERE` with the actual ID you copied in Step 2.4.

### 4. Initial Data Processing and Model Training

Before running the Streamlit app, you need to perform an initial data transformation and model training to generate the necessary `Processed Data` in your Google Sheet and the trained model files locally.

1.  **Ensure virtual environment is active.**
2.  **From the `ai-workout-app/` (project root) directory, run:**
    ```bash
    python3 src/transform.py
    python3 src/train_model.py
    ```
    - `src/transform.py`: Reads `Raw Data`, processes it, and writes to `Processed Data` in your Google Sheet.
    - `src/train_model.py`: Reads from `Processed Data` (Google Sheet), trains the ML model, and saves it to `models/`.

## Running the Application

1.  **Activate your virtual environment** (if not already active).
2.  **Navigate into the `app/` directory:**
    ```bash
    cd app/
    ```
3.  **Run the Streamlit application:**
    ```bash
    streamlit run app.py
    ```
    Your web browser should automatically open the app (usually at `http://localhost:8501`).

## Usage

- **Home:** Provides a brief introduction to the application.
- **Get Recommendation:** Input your most recent workout performance for a chosen exercise and receive a personalized weight recommendation for your next set. After receiving a recommendation, you'll have the option to log that workout (with potential adjustments) directly from this page.
- **Log Workout:** A dedicated page to manually log your completed training sessions. Logging a workout will trigger the background processes to update your `Processed Data` and retrain the model.
- **Workout History:** Explore your past workouts, filter by exercise, and visualize your weight progression over time.
- **Model Insights:** (To be further developed) View details about the machine learning model, including feature importance and performance metrics.

## Development & Experimentation (Optional)

The `notebooks/` directory contains Jupyter notebooks that were likely used during the development phase for Exploratory Data Analysis (EDA) and model experimentation. These can be incredibly useful for:

* **Understanding the Data:** See how features are engineered, explore data distributions, and identify potential outliers or issues.
* **Model Evaluation:** Dive deeper into model performance metrics, visualize residuals, and understand why the model makes certain predictions.
* **Experimenting with New Models/Features:** Test out different machine learning algorithms, fine-tune hyperparameters, or explore new feature engineering techniques without affecting the main application code.

**How to use the notebooks:**

1.  **Install Jupyter:** If you don't have Jupyter installed, activate your virtual environment and run:
    ```bash
    pip install jupyter
    ```
2.  **Launch Jupyter Lab/Notebook:** From the root directory of your project (`ai-workout-app/`), run:
    ```bash
    jupyter lab
    # OR
    jupyter notebook
    ```
3.  **Navigate to `notebooks/`:** In the Jupyter interface that opens in your browser, navigate to the `notebooks/` directory.
4.  **Open and Run:** Click on `EDA_Workout_Data.ipynb` to open them. You can run cells sequentially (`Shift + Enter`) to execute the code and see the outputs.

## Troubleshooting

- **`gspread.exceptions.APIError: {'code': 403, 'message': 'The caller does not have permission'`**: This is a common Google Sheets API error. It means your Google Service Account does not have `Editor` access to the specific Google Sheet. Double-check the sharing settings for your Google Sheet, ensuring the `client_email` from your `google_credentials.json` is explicitly added as an `Editor`.
- **"No data to train model"**: Ensure you have some historical workout data entered into the `Raw Data` tab of your Google Sheet and that `src/transform.py` ran successfully.
- **Missing `.joblib` files in `models/`**: If you get errors related to missing model files, ensure you have successfully run `python3 src/transform.py` and `python3 src/train_model.py` at least once from the project root.

## Contributing

Feel free to fork this repository, open issues, or submit pull requests. All contributions are welcome!

## License

This project is open-source and available under the [MIT License](https://opensource.org/licenses/MIT).
